# XRD峰匹配分析程序 v3.0 用户手册

## 🚀 程序概述

XRD峰匹配分析程序是一个专业的X射线衍射(XRD)数据分析工具，具有图形化界面，支持自动峰检测、PDF卡片匹配和多物相识别。

### ✨ 主要功能

- **智能峰检测**: 自适应峰检测算法，自动调整参数
- **多格式支持**: 支持多种XRD数据文件格式
- **PDF卡片匹配**: 自动匹配PDF标准卡片数据
- **多物相识别**: 同时识别多个物相
- **可视化分析**: 专业的图表显示和标注
- **参数调整**: 丰富的配置选项，支持实时调整
- **结果导出**: 高质量图像保存

## 📦 安装与运行

### 系统要求
- Windows 7/10/11
- Python 3.7 或更高版本

### 依赖包安装
```bash
pip install pandas matplotlib scipy numpy tkinter
```

### 快速启动
1. 双击运行 `start_xrd_analyzer.py`
2. 或者在命令行中运行:
   ```bash
   python start_xrd_analyzer.py
   ```

## 🎯 使用教程

### 第一步：准备数据文件

#### 实验数据文件格式
- 支持 `.txt`, `.csv` 格式
- 数据格式: 两列数据（2θ角度, 强度）
- 示例:
  ```
  10.0    150
  10.1    155
  10.2    160
  ...
  ```

#### PDF卡片文件格式
- 支持标准PDF卡片格式
- 数据格式: 包含2θ角度和相对强度
- 可以包含注释行（以#开头）

### 第二步：加载数据

1. **选择实验数据文件**
   - 点击"浏览"按钮选择实验XRD数据文件
   - 程序会自动检测文件格式

2. **添加PDF卡片文件**
   - 点击"添加PDF"按钮选择一个或多个PDF卡片文件
   - 支持多选，按住Ctrl键可选择多个文件
   - 已选择的文件会显示在列表中

### 第三步：参数调整

程序提供四个参数调整选项卡：

#### 🔍 峰检测参数
- **峰高阈值**: 检测峰的最小高度（推荐：50-200）
- **峰间距离**: 相邻峰之间的最小距离（推荐：10-20）
- **峰突出度**: 峰相对于基线的突出程度（推荐：30-100）
- **峰宽度**: 峰的最小宽度（推荐：1-5）
- **匹配容差**: 实验峰与理论峰的匹配容差，单位度（推荐：0.1-0.3）

#### 🎨 显示设置
- **图形尺寸**: 调整图表的宽度和高度
- **线条样式**: 设置线条宽度和标记大小
- **字体设置**: 调整字体和标题大小
- **颜色设置**: 自定义实验数据和未匹配峰的颜色

#### 📊 数据处理
- **角度范围**: 设置分析的2θ角度范围
- **强度阈值**: 过滤低强度数据点
- **平滑窗口**: 数据平滑处理窗口大小

#### 💾 输出设置
- **保存DPI**: 图像保存的分辨率（推荐：300）
- **自动保存**: 是否自动保存分析结果
- **显示选项**: 控制统计信息和未匹配峰的显示

### 第四步：开始分析

1. 点击"开始分析"按钮
2. 程序会自动执行以下步骤：
   - 加载和验证数据
   - 执行峰检测
   - 进行峰匹配
   - 生成可视化结果

### 第五步：结果查看

分析完成后，右侧会显示：
- **XRD图谱**: 实验数据曲线
- **峰标注**: 不同符号标注不同物相
- **图例**: 显示各物相的识别符号
- **统计信息**: 显示匹配率等统计数据

## ⚙️ 高级功能

### 配置管理
- **保存配置**: 将当前参数设置保存为配置文件
- **加载配置**: 从配置文件加载参数设置
- 配置文件格式为JSON，便于编辑和分享

### 数据导出
- 分析结果自动保存为高分辨率PNG图像
- 文件名包含时间戳，避免覆盖
- 保存位置与实验数据文件相同

### 日志监控
- 底部日志窗口显示程序运行状态
- 记录所有重要操作和错误信息
- 帮助用户了解分析过程

## 🔧 故障排除

### 常见问题

#### 1. 程序无法启动
**可能原因**: 缺少依赖包
**解决方案**: 
```bash
pip install pandas matplotlib scipy numpy
```

#### 2. 文件加载失败
**可能原因**: 文件格式不支持或数据格式错误
**解决方案**: 
- 检查文件是否为文本格式
- 确保数据为两列数字格式
- 尝试不同的编码格式

#### 3. 峰检测结果不理想
**可能原因**: 峰检测参数不合适
**解决方案**: 
- 降低峰高阈值和突出度
- 调整峰间距离参数
- 检查数据质量

#### 4. 匹配率很低
**可能原因**: 匹配容差过小或PDF卡片不匹配
**解决方案**: 
- 增加匹配容差（0.2-0.5度）
- 检查PDF卡片是否正确
- 确认样品与参考物相一致

#### 5. 中文显示乱码
**可能原因**: 系统字体设置问题
**解决方案**: 程序会自动尝试多种中文字体，通常无需手动处理

### 参数调整建议

#### 对于不同类型的样品：

**高结晶度样品**:
- 峰高阈值: 100-300
- 峰间距离: 15-25
- 匹配容差: 0.1-0.2°

**低结晶度样品**:
- 峰高阈值: 30-100
- 峰间距离: 10-15
- 匹配容差: 0.2-0.4°

**多物相样品**:
- 峰高阈值: 50-150
- 峰突出度: 适当降低
- 匹配容差: 0.15-0.25°

## 📞 技术支持

### 联系方式
- 如遇技术问题，请查看程序日志获取详细错误信息
- 保存配置文件和示例数据以便问题重现

### 更新日志
**v3.0** (当前版本)
- 全新图形化界面
- 增强的参数配置系统
- 改进的文件格式支持
- 更好的错误处理和用户反馈
- 配置保存和加载功能

**v2.0**
- 改进的峰检测算法
- 多物相识别优化
- 中文字体显示修复

**v1.0**
- 基础XRD峰匹配功能
- 命令行界面版本

## 📝 最佳实践

1. **数据预处理**: 确保实验数据质量，必要时进行噪声过滤
2. **参数调试**: 从推荐参数开始，根据结果逐步调整
3. **PDF卡片选择**: 选择与样品最相关的标准卡片
4. **结果验证**: 结合其他分析方法验证识别结果
5. **定期备份**: 保存重要的配置文件和分析结果

---

**感谢使用XRD峰匹配分析程序！**
